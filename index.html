<script>
    async function submitForm() {
        const name = document.getElementById('name').value;
        const year = document.getElementById('year').value;
        const datesSeeking = document.getElementById('datesSeeking').value.split(',').map(date => date.trim());
        const datesAvailable = document.getElementById('datesAvailable').value.split(',').map(date => date.trim());

        const resident = {
            name,
            year,
            datesSeeking,
            datesAvailable
        };

        const response = await fetch('https://shiftswap-backend.onrender.com/residents', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(resident)
        });

        const result = await response.json();
        findMatch(result);
    }

    async function findMatch(newResident) {
        const response = await fetch('https://shiftswap-backend.onrender.com/residents');
        const residents = await response.json();

        let match = null;

        for (let i = 0; i < residents.length; i++) {
            const res = residents[i];
            if (res._id !== newResident._id) {
                const seekingOverlap = newResident.datesSeeking.some(date => res.datesAvailable.includes(date));
                const availableOverlap = newResident.datesAvailable.some(date => res.datesSeeking.includes(date));

                if (seekingOverlap && availableOverlap) {
                    match = res;
                    break;
                }
            }
        }

        const matchResult = document.getElementById('matchResult');
        const matchText = document.getElementById('matchText');

        if (match) {
            matchText.innerHTML = `Match found with ${match.name} (${match.year})!<br>
            Dates you can cover for them: ${newResident.datesAvailable.filter(date => match.datesSeeking.includes(date)).join(', ')}<br>
            Dates they can cover for you: ${newResident.datesSeeking.filter(date => match.datesAvailable.includes(date)).join(', ')}`;
            matchResult.style.display = 'block';
        } else {
            matchText.innerHTML = 'No match found. Please try again later.';
            matchResult.style.display = 'block';
        }
    }
</script>
